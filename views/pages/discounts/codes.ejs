<%- include('../../layouts/admin', { body: `

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-1">
      <i class="ti ti-tag me-2"></i>
      İndirim Kodları
    </h4>
    <p class="text-muted mb-0">Oluşturulan tüm indirim kodları</p>
  </div>
  <div class="d-flex gap-2">
    <select class="form-select" style="width: auto;" id="statusFilter">
      <option value="">Tüm Durumlar</option>
      <option value="CREATED">Bekleyen</option>
      <option value="USED">Kullanılmış</option>
      <option value="EXPIRED">Süresi Dolmuş</option>
    </select>
  </div>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-modern mb-0">
        <thead>
          <tr>
            <th>Kod</th>
            <th>Ziyaretçi</th>
            <th>Kural</th>
            <th>Tür</th>
            <th>Değer</th>
            <th>Durum</th>
            <th>Oluşturulma</th>
            <th>Son Kullanma</th>
          </tr>
        </thead>
        <tbody>
          ${ typeof discounts !== 'undefined' && discounts.length > 0 ? discounts.map(discount => \`
            <tr>
              <td>
                <code class="text-primary fw-bold">\${ discount.code }</code>
              </td>
              <td>
                <div class="d-flex align-items-center">
                  <div class="avatar avatar-sm me-2">
                    <span class="avatar-initial rounded-circle bg-label-secondary">
                      <i class="ti ti-user"></i>
                    </span>
                  </div>
                  <span class="text-truncate" style="max-width: 120px;">
                    \${ discount.visitor.email || discount.visitor.fingerprint.substring(0, 10) + '...' }
                  </span>
                </div>
              </td>
              <td>
                <span class="badge bg-label-info">\${ discount.rule.name }</span>
              </td>
              <td>
                <span class="badge bg-label-\${ discount.type === 'PERCENTAGE' ? 'primary' : discount.type === 'FREE_SHIPPING' ? 'success' : 'warning' }">
                  \${ discount.type === 'PERCENTAGE' ? '%' : discount.type === 'FREE_SHIPPING' ? 'Kargo' : '$' }
                </span>
              </td>
              <td>
                <strong>\${ discount.type === 'FREE_SHIPPING' ? 'Bedava' : discount.type === 'PERCENTAGE' ? discount.value + '%' : '$' + discount.value }</strong>
              </td>
              <td>
                <span class="badge badge-soft \${ discount.status === 'USED' ? 'badge-soft-success' : discount.status === 'EXPIRED' ? 'badge-soft-danger' : 'badge-soft-warning' }">
                  <i class="ti ti-\${ discount.status === 'USED' ? 'check' : discount.status === 'EXPIRED' ? 'x' : 'clock' } me-1"></i>
                  \${ discount.status === 'USED' ? 'Kullanıldı' : discount.status === 'EXPIRED' ? 'Süresi Doldu' : 'Bekliyor' }
                </span>
              </td>
              <td>
                <small class="text-muted">\${ new Date(discount.createdAt).toLocaleDateString('tr-TR') }</small>
              </td>
              <td>
                <small class="\${ new Date(discount.expiresAt) < new Date() ? 'text-danger' : 'text-muted' }">
                  \${ new Date(discount.expiresAt).toLocaleDateString('tr-TR') }
                </small>
              </td>
            </tr>
          \`).join('') : \`
            <tr>
              <td colspan="8" class="text-center py-5">
                <div class="empty-state">
                  <i class="ti ti-tag"></i>
                  <p class="mb-0">Henüz indirim kodu oluşturulmamış</p>
                </div>
              </td>
            </tr>
          \` }
        </tbody>
      </table>
    </div>
  </div>
  ${ typeof pagination !== 'undefined' && pagination.totalPages > 1 ? \`
    <div class="card-footer d-flex justify-content-between align-items-center">
      <small class="text-muted">Toplam \${ pagination.total } kod</small>
      <nav>
        <ul class="pagination pagination-sm mb-0">
          <li class="page-item \${ !pagination.hasPrev ? 'disabled' : '' }">
            <a class="page-link" href="?page=\${ pagination.page - 1 }">Önceki</a>
          </li>
          <li class="page-item active">
            <span class="page-link">\${ pagination.page } / \${ pagination.totalPages }</span>
          </li>
          <li class="page-item \${ !pagination.hasNext ? 'disabled' : '' }">
            <a class="page-link" href="?page=\${ pagination.page + 1 }">Sonraki</a>
          </li>
        </ul>
      </nav>
    </div>
  \` : '' }
</div>

<script>
document.getElementById('statusFilter').addEventListener('change', function() {
  const status = this.value;
  window.location.href = status ? \`/discounts/codes?status=\${status}\` : '/discounts/codes';
});
</script>

`, active: 'codes' }) %>

